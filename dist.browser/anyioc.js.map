{"version":3,"sources":["webpack://anyioc/webpack/bootstrap","webpack://anyioc/./dist/anyioc.js"],"names":[],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;AClFA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,uDAAuD;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,4BAA4B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,oDAAoD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,sBAAsB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kC","file":"anyioc.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./dist/anyioc.js\");\n","\"use strict\";\r\n/* Copyright (c) 2018~2999 - Cologler <skyoflw@gmail.com> */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Symbols = {\r\n    Provider: Symbol('Provider'),\r\n    RootProvider: Symbol('RootProvider'),\r\n    Cache: Symbol('Cache'),\r\n    MissingResolver: Symbol('MissingResolver'),\r\n};\r\nvar LifeTime;\r\n(function (LifeTime) {\r\n    LifeTime[LifeTime[\"Transient\"] = 0] = \"Transient\";\r\n    LifeTime[LifeTime[\"Scoped\"] = 1] = \"Scoped\";\r\n    LifeTime[LifeTime[\"Singleton\"] = 2] = \"Singleton\";\r\n})(LifeTime = exports.LifeTime || (exports.LifeTime = {}));\r\nvar Services;\r\n(function (Services) {\r\n    class ServiceInfo {\r\n        constructor(_factory, _lifetime) {\r\n            this._factory = _factory;\r\n            this._lifetime = _lifetime;\r\n            this._cache_value = null;\r\n        }\r\n        get(provider) {\r\n            switch (this._lifetime) {\r\n                case LifeTime.Transient:\r\n                    return this._factory(provider);\r\n                case LifeTime.Scoped:\r\n                    const cache = provider.get(exports.Symbols.Cache);\r\n                    if (!cache.has(this)) {\r\n                        cache.set(this, this._factory(provider));\r\n                    }\r\n                    return cache.get(this);\r\n                case LifeTime.Singleton:\r\n                    if (this._cache_value === null) {\r\n                        provider = provider.get(exports.Symbols.RootProvider);\r\n                        this._cache_value = [this._factory(provider)];\r\n                    }\r\n                    return this._cache_value[0];\r\n            }\r\n        }\r\n    }\r\n    Services.ServiceInfo = ServiceInfo;\r\n    class ProviderServiceInfo {\r\n        get(provider) {\r\n            return provider;\r\n        }\r\n    }\r\n    Services.ProviderServiceInfo = ProviderServiceInfo;\r\n    class ValueServiceInfo {\r\n        constructor(_value) {\r\n            this._value = _value;\r\n        }\r\n        get(provider) {\r\n            return this._value;\r\n        }\r\n    }\r\n    Services.ValueServiceInfo = ValueServiceInfo;\r\n    class GroupedServiceInfo {\r\n        constructor(_keys) {\r\n            this._keys = _keys;\r\n        }\r\n        get(provider) {\r\n            return this._keys.map(key => provider.get(key));\r\n        }\r\n    }\r\n    Services.GroupedServiceInfo = GroupedServiceInfo;\r\n})(Services || (Services = {}));\r\nvar Missing;\r\n(function (Missing) {\r\n    class MissingResolver {\r\n        get(provider, key) {\r\n            return undefined;\r\n        }\r\n    }\r\n    Missing.MissingResolver = MissingResolver;\r\n})(Missing = exports.Missing || (exports.Missing = {}));\r\nvar Utils;\r\n(function (Utils) {\r\n    class ChainMap {\r\n        constructor(parents = []) {\r\n            this._maps = [new Map()];\r\n            this._maps.push(...parents);\r\n        }\r\n        get(key) {\r\n            for (const map of this._maps) {\r\n                if (map.has(key)) {\r\n                    return map.get(key);\r\n                }\r\n            }\r\n            return undefined;\r\n        }\r\n        set(key, value) {\r\n            this._maps[0].set(key, value);\r\n        }\r\n        child() {\r\n            return new ChainMap(this._maps);\r\n        }\r\n    }\r\n    Utils.ChainMap = ChainMap;\r\n})(Utils || (Utils = {}));\r\nclass ScopedServiceProvider {\r\n    constructor(_services) {\r\n        this._services = _services;\r\n        this.registerValue(exports.Symbols.Cache, new Map());\r\n    }\r\n    get(key) {\r\n        const serviceInfo = this._services.get(key);\r\n        if (serviceInfo) {\r\n            return serviceInfo.get(this);\r\n        }\r\n        const resolverServiceInfo = this._services.get(exports.Symbols.MissingResolver);\r\n        const resolver = resolverServiceInfo.get(this);\r\n        return resolver.get(this, key);\r\n    }\r\n    registerServiceInfo(key, serviceInfo) {\r\n        this._services.set(key, serviceInfo);\r\n    }\r\n    registerValue(key, value) {\r\n        this._services.set(key, new Services.ValueServiceInfo(value));\r\n    }\r\n    register(key, factory, lifetime) {\r\n        this._services.set(key, new Services.ServiceInfo(factory, lifetime));\r\n    }\r\n    registerTransient(key, factory) {\r\n        return this.register(key, factory, LifeTime.Transient);\r\n    }\r\n    registerScoped(key, factory) {\r\n        return this.register(key, factory, LifeTime.Scoped);\r\n    }\r\n    registerSingleton(key, factory) {\r\n        return this.register(key, factory, LifeTime.Singleton);\r\n    }\r\n    registerGroup(key, keys) {\r\n        this._services.set(key, new Services.GroupedServiceInfo(keys));\r\n    }\r\n    scope() {\r\n        return new ScopedServiceProvider(this._services.child());\r\n    }\r\n}\r\n/**\r\n * the main class for anyioc.\r\n *\r\n * @export\r\n * @class ServiceProvider\r\n * @extends {ScopedServiceProvider}\r\n */\r\nclass ServiceProvider extends ScopedServiceProvider {\r\n    constructor() {\r\n        super(new Utils.ChainMap());\r\n        this.registerServiceInfo(exports.Symbols.Provider, new Services.ProviderServiceInfo());\r\n        this.registerValue(exports.Symbols.RootProvider, this);\r\n        this.registerValue(exports.Symbols.MissingResolver, new Missing.MissingResolver());\r\n        // alias\r\n        this.registerTransient('ioc', ioc => ioc.get(exports.Symbols.Provider));\r\n        this.registerTransient('provider', ioc => ioc.get(exports.Symbols.Provider));\r\n    }\r\n}\r\nexports.ServiceProvider = ServiceProvider;\r\n//# sourceMappingURL=anyioc.js.map"],"sourceRoot":""}